# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Проект выстроен в соответствии с шаблоном проектирования MVP (Model-View-Presenter) и разделен на три слоя: слой данных, слой представления и презентер. Классы модели данных и представления вынесены в отдельные компоненты, а логика презентера реализована в основном скрипте `index.ts`.

Также в проекте используется событийно-ориентированный подход. За его реализацию отвечают брокер событий и презентер. Для этого брокер событий добавляется в конструктор некоторых классов, чтобы генерировать события в определенных ситуациях, а презентер реагирует на них в своем коде.

### Описание данных

В проекте используются следующие типы данных и интерфейсы:

```
type ItemCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил' // Тип для описания категории товара

type Price = number | null // Тип для поисания цены товара

type Payment = 'card' | 'cash' // Тип для описания способа оплаты

interface IId {
    id: string;
} // Интерфейс для описания идентификатора товара или заказа

interface ITotalPrice { 
    total: Price;
} // Интерфейс для описания суммарной стоимости заказа

interface ICartCheck {
    inCart: boolean;
} // Интерфейс для описания наличия товара в корзине

interface IShopItem extends IId {
    description: string;
    image: string;
    title: string;
    category: ItemCategory;
    price: Price;
} // Интерфейс для описания товара

interface IItemCard extends IShopItem, ICartCheck {} // Интерфейс для передачи данных в компонент представления, отвечающий за карточку товара

interface IProductList {
    total: number;
    items: IShopItem[];
} // Интерфейс для описания списка товаров и их количества

interface IUserData {
    email: string;
    phone: string;
    address: string;
} // Интерфейс для описания данных пользователя

interface IOrderData extends IUserData, ITotalPrice {
    payment: Payment;
    items: string[];
} // Интерфейс для описания данных заказа

interface IOrderResult extends ITotalPrice, IId {} // Интерфейс для описания результата, сформированного после отправки заказа

interface IElementCollection {
    items: HTMLElement[];
} // Интерфейс для описания коллекции однотипных HTML-элементов

interface IPage extends IElementCollection {
    cartAmount: number;
} // Интерфейс для передачи данных в компонент представления, отвечающий за всю страницу

interface IModal {
    content: HTMLElement;
} // Интерфейс для передачи данных в компонент представления, отвечающий за модальное окно

interface ICart extends IElementCollection, ITotalPrice {} // Интерфейс для передачи данных в компонент представления, отвечающий за корзину

interface IFormState {
    valid: boolean;
    errors: keyof IOrderData[];
} // Интерфейс, описывающий состояние формы, который используется для передачи данных в компонент представления, отвечающий за форму

interface IContactForm extends IFormState {
    payment: Payment;
} // Интерфейс для передачи данных в компонент представления формы с выбором способа оплаты

interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
} // Интерфейс для описания брокера событий
```

### Базовые компоненты

Следующие компоненты обладают общим функционалом и используются как основа для компонентов, специфичных для данного проекта.

#### Класс `Api`

Базовый класс для работы с API.

Конструктор принимает аргумент `baseUrl: string`, отвечающий за основную ссылку на API, используемую для всех запросов.

##### Методы класса

`handleResponse(response: Response): Promise<object>` — отвечает за обработку ответа от сервера, преобразовывая его в `json`, если запрос успешен

`get(uri: string)` — отвечает за запросы с методом `GET`

`post(uri: string, data: object, method: ApiPostMethods = 'POST')` — отвечает за запросы с методом `POST`

#### Класс `EventEmitter`

Базовый брокер событий. Позволяет устанавливать обработчики событий и реагировать на них.

##### Методы класса

В данном проекте используются следующие методы класса.

`on<T extends object>(eventName: EventName, callback: (event: T) => void)` — позволяет установить обработчик на событие

`emit<T extends object>(eventName: string, data?: T)` — позволяет инициировать событие с данными

#### Класс `Component<T>`

Базовый класс, который наследуют все компоненты представления. Класс является дженериком и принимает в переменной `T` тип данных, отображаемых в компонентах представления.

Конструктор принимает аргумент `container: HTMLElement`, отвечающий за отображение определенного HTML-элемента.

##### Методы класса

В данном проекте используются следующие методы класса.

`toggleClass(element: HTMLElement, className: string, force?: boolean)` — отвечает за переключение определенного класса у элемента

`setText(element: HTMLElement, value: unknown)` — отвечает за установку текстового содержимого у желаемого элемента

`setImage(element: HTMLImageElement, src: string, alt?: string)` — отвечает за установку ссылки и альтернативного текста изображения

`render(data?: Partial<T>): HTMLElement` — отвечает за рендеринг элемента и позволяет указать полные или частичные данные определенного типа, которые требуется отобразить

### Компоненты модели данных

#### Класс `ShopModel`

Этот класс отвечает за бизнес-логику приложения и позволяет выполнять все необходимые операции с данными.

Конструктор принимает аргумент `events: IEvents`, отвечающий за указание брокера событий.

##### Поля класса

`items: IShopItem[]` — массив всех предметов в каталоге

`cart: string[]` — массив идентификаторов товаров, добавленных в корзину

`order: IOrderData` — сведения о заказе

##### Методы класса

`getItem(id: string): IShopItem` — возвращает объект товара с указанным `id`

`setItems(items: IShopItem[])` — позволяет установить весь массив товаров в каталоге

`addToCart(id: string)` — позволяет добавить товар в корзину

`removeFromCart(id: string)` — удаляет товар из корзины

`clearCart()` — удаляет все товары из корзины

`getCartAmount: number` — возвращает общее количество товаров в корзине

`getCartTotal: Price` — возвращает суммарную стоимость всех товаров в корзине

`setOrderField(field: keyof IOrderData, value: string | Payment)` — позволяет установить значение определнного поля в объекте заказа

`setOrderItems(items: string[])` — позволяет указать весь массив с `id` товаров в поле `items` объекта заказа

`inCart(id: string): boolean` — позволяет проверить, находится ли в корзине товар с указанным `id`

`validate(data: Partial<IOrderData>): IFormState` — валидирует данные, указанные при оформлении заказа

#### Класс `ShopAPI`

Класс для работы с API магазина.

Конструктор принимает следующие аргументы:

`baseUrl: string` — основная ссылка на API

`cdn: string` — ссылка для изображений (является полем класса)

##### Методы класса

`getItems(): Promise<IProductList>` — позволяет получить список товаров с сервера

`getItem(id: string): Promise<IShopItem>` — позволяет получить определенный товар с сервера

`placeOrder(): Promise<IOrderResult>` — позволяет разместить заказ на сервере

### Компоненты представления

#### Класс `Page`

Наследует класс `Component` с переданным типом `<IPage>`.

Отвечает за отображение каталога товаров и индикатора количества товаров в корзине.

Использует родительский конструктор.

##### Поля класса

`_items: HTMLElement` — каталог товаров

`_cartIcon: HTMLButtonElement` — иконка корзины

`_cartAmount: HTMLElement` — индикатор количества товаров в корзине

##### Методы класса

`set items(value: HTMLElement[])` — наполняет элемент каталога `_items` карточками товаров

`set cartAmount(value: number)` — позволяет отобразить в элементе `_cartAmount` количество товаров в корзине

#### Класс `ItemCard`

Наследует класс `Component` с переданным типом `<IItemCard>`.

Используется для отображения карточки товара в различных контекстах.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_id: string` — идентификатор товара для передачи в брокер событий

`_description: HTMLElement` — описание товара (необязательное поле)

`_image: HTMLImageElement` — изображение товара (необязательное поле)

`_title: HTMLElement` — название товара

`_category: HTMLElement` — категория товара (необязательное поле)

`_price: HTMLElement` — цена товара

`_index: HTMLElement` — порядковый номер товара в списке (необязательное поле)

`_button: HTMLButtonElement` — кнопка добавления / удаления товара из корзины

##### Методы класса

`set id (value: string)` — определяет значение поля `_id`

`set description (value: string)` — определяет текстовое содержимое элемента `_description`, если таковой присутствует

`set image (value: string)` — определяет содержимое элемента `_image`, если таковой присутствует

`set title (value: string)` — определяет текстовое содержимое элемента `_title`

`set category (value: ItemCategory)` — определяет текстовое содержимое элемента `category`, если таковой присутствует

`set price (value: Price)`  — определяет текстовое содержимое элемента `_price`

`set inCart(value: boolean)` — определяет текстовое содержимое кнопки `_button` в соответствии со значением

#### Класс `Modal`

Наследует класс `Component` с переданным типом `<IModal>`.

Используется для отображения модального окна с любым содержимым.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_closeButton: HTMLButtonElement` — кнопка закрытия модального окна

`_content: HTMLElement` — содержимое модального окна

##### Методы класса

`set content(value: HTMLElement)` — определяет содержимое элемента `_content`

`open()` — отвечает за открытие модального окна

`close()` — отвечает за закрытие модального окна

#### Класс `Cart`

Наследует класс `Component` с переданным типом `<ICart>`.

Используется для отображения списка добавленных в корзину товаров с возможностью приступить к формлению заказа.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_items: HTMLElement` — контейнер для списка добавленных товаров

`_button: HTMLButtonElement` — кнопка оформления заказа

`_total: HTMLElement` — суммарная стоимость заказа

##### Методы класса

`set items(value: HTMLElement[])` — наполняет элемент `_items` карточками товаров, а также определяет статус активности кнопки `_button` в зависимости от наличия товаров

`set total(value: Price)` — определяет текстовое содержимое элемента `_total` 

#### Класс `Form<T extends IFormState = IFormState>`

Наследует класс `Component<T>`. По умолчанию принимает в переменную `T` объект, соответствующий интерфейсу `IFormState`, но позволяет использовать любой другой интерфейс, расширяющий `IFormState`, у классов, которые его наследуют.

Общий класс для отображения всех форм в проекте.

Конструктор принимает аргументы `container: HTMLFormElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_button: HTMLButtonElement` — кнопка сабмита формы

`_error: HTMLElement` — отображение ошибок при заполнении или сабмите формы

`_inputs: HTMLInputElement[]` — массив с текстовыми полями формы

##### Методы класса

`set errors(value: keyof IOrderData[])` — отвечает за отображение текстовых полей, с которыми связаны ошибки

`set valid(data: boolean)` — изменяет статус активности кнопки в зависимости от значения

`displayError(value: string)` — определяет текстовое содержимое элемента `_error`

#### Класс `OrderForm`

Наследует класс `Form<IContactForm>`.

Используется для отображения формы оформления заказа с выбором способа оплаты.

Использует родительский конструктор.

##### Поля класса

`_paymentSelection: HTMLElement` — элемент с кнопками выбора способа оплаты.

##### Методы класса

`set payment(value: Payment)` — определяет статус активности кнопки с атрибутом `name`, соответствующим переданному значению

`set address(value: string)` — позволяет задать значение полю с именем `address`

#### Класс `ContactForm`

Наследует класс `Form`.

Используется для отображения формы с указанием контактных данных.

Использует родительский конструктор.

##### Методы класса

`set email(value: string)` — позволяет задать значение полю с именем `email`

`set phone(value: string)` — позволяет задать значение полю с именем `phone`

#### Класс `OrderSuccess`

Наследует класс `Component` с переданным типом `<ITotalPrice>`.

Отвечает за отображение подтверждения успешной покупки.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_spent: HTMLElement` — общая сумма заказа

`_button: HTMLButtonElement` — кнопка подтверждения для перехода на главный экран

##### Методы класса

`set total(value: Price)` — определяет текстовое содержимое элемента `_spent`