# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Проект выстроен в соответствии с шаблоном проектирования MVP (Model-View-Presenter) и разделен на три слоя: слой данных, слой представления и презентер. Классы модели данных и представления вынесены в отдельные компоненты, а логика презентера реализована в основном скрипте `index.ts`.

Также в проекте используется событийно-ориентированный подход. За его реализацию отвечают брокер событий и презентер. Для этого брокер событий добавляется в конструктор некоторых классов, чтобы генерировать события в определенных ситуациях, а презентер реагирует на них в своем коде.

### Описание данных

В проекте используются следующие типы данных и интерфейсы:

```
type ItemCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил' // Тип для описания категории товара

type Price = number | null // Тип для поисания цены товара

type Payment = 'card' | 'cash' // Тип для описания способа оплаты

interface IId {
    id: string;
} // Интерфейс для описания идентификатора товара или заказа

interface ITotalPrice { 
    total: Price;
} // Интерфейс для описания суммарной стоимости заказа

interface ICartCheck {
    inCart: boolean;
} // Интерфейс для описания наличия товара в корзине

interface IShopItem extends IId {
    description: string;
    image: string;
    title: string;
    category: ItemCategory;
    price: Price;
} // Интерфейс для описания товара

type ICartItem = Pick<IShopItem, "title" | "price" | "id"> // Интерфейс для описания товара в корзине

interface IProductList {
    total: number;
    items: IShopItem[];
} // Интерфейс для описания списка товаров и их количества

interface IUserData {
    email: string;
    phone: string;
    address: string;
} // Интерфейс для описания данных пользователя

interface IOrderData extends IUserData, ITotalPrice {
    payment: Payment;
    items: string[];
} // Интерфейс для описания данных заказа

type IOrderResult = ITotalPrice & IId // Интерфейс для описания результата, сформированного после отправки заказа

interface IElementCollection {
    items: HTMLElement[];
} // Интерфейс для описания коллекции однотипных HTML-элементов

interface IPage extends IElementCollection {
    cartAmount: number;
} // Интерфейс для передачи данных в компонент представления, отвечающий за всю страницу

interface IModal {
    content: HTMLElement;
} // Интерфейс для передачи данных в компонент представления, отвечающий за модальное окно

interface IButton {
    buttonActive: boolean;
    buttonText: string;
} // Интерфейс для передачи данных в компонент представления, отвечающий за кнопку

type ICart = IElementCollection & ITotalPrice // Интерфейс для передачи данных в компонент представления, отвечающий за корзину

interface IToggler {
    selected: string;
} // Интерфейс для передачи данных в компонент представления, отвечающий за переключатель кнопок

interface IFormState {
    valid: boolean;
    errors: keyof IOrderData[];
} // Интерфейс, описывающий состояние формы, который используется для передачи данных в компонент представления, отвечающий за форму

type IItemPreview = IShopItem & ICartCheck // Интерфейс для передачи данных в компонент представления, отвечающий за режим просмотра товара

interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
} // Интерфейс для описания брокера событий
```

### Базовые компоненты

Следующие компоненты обладают общим функционалом и используются как основа для компонентов, специфичных для данного проекта.

#### Класс `Api`

Базовый класс для работы с API.

Конструктор принимает аргумент `baseUrl: string`, отвечающий за основную ссылку на API, используемую для всех запросов.

##### Методы класса

`handleResponse(response: Response): Promise<object>` — отвечает за обработку ответа от сервера, преобразовывая его в `json`, если запрос успешен

`get(uri: string)` — отвечает за запросы с методом `GET`

`post(uri: string, data: object, method: ApiPostMethods = 'POST')` — отвечает за запросы с методом `POST`

#### Класс `EventEmitter`

Базовый брокер событий. Позволяет устанавливать обработчики событий и реагировать на них.

##### Методы класса

В данном проекте используются следующие методы класса.

`on<T extends object>(eventName: EventName, callback: (event: T) => void)` — позволяет установить обработчик на событие

`emit<T extends object>(eventName: string, data?: T)` — позволяет инициировать событие с данными

#### Класс `Component<T>`

Базовый класс, который наследуют все компоненты представления. Класс является дженериком и принимает в переменной `T` тип данных, отображаемых в компонентах представления.

Конструктор принимает аргумент `container: HTMLElement`, отвечающий за отображение определенного HTML-элемента.

##### Методы класса

В данном проекте используются следующие методы класса.

`toggleClass(element: HTMLElement, className: string, force?: boolean)` — отвечает за переключение определенного класса у элемента

`setText(element: HTMLElement, value: unknown)` — отвечает за установку текстового содержимого у желаемого элемента

`setImage(element: HTMLImageElement, src: string, alt?: string)` — отвечает за установку ссылки и альтернативного текста изображения

`render(data?: Partial<T>): HTMLElement` — отвечает за рендеринг элемента и позволяет указать полные или частичные данные определенного типа, которые требуется отобразить

### Компоненты модели данных

#### Класс `ShopModel`

Этот класс отвечает за бизнес-логику приложения и позволяет выполнять все необходимые операции с данными.

Конструктор принимает аргумент `events: IEvents`, отвечающий за указание брокера событий.

##### Поля класса

`items: IShopItem[]` — массив всех предметов в каталоге

`cart: ICartItem[]` — массив товаров в корзине

`order: IOrderData` — сведения о заказе

##### Методы класса

`getItem(id: string): IShopItem` — возвращает объект товара с указанным `id`

`getCartItem(id: string): ICartItem` — возвращает объект товара в корзине с указанным `id`

`setItems(items: IShopItem[])` — позволяет установить весь массив товаров в каталоге

`addToCart(item: IShopItem)` — позволяет добавить товар в корзину

`removeFromCart(id: string)` — удаляет товар из корзины

`clearCart()` — удаляет все товары из корзины

`getCartAmount: number` — возвращает общее количество товаров в корзине

`getCartTotal: Price` — возвращает суммарную стоимость всех товаров в корзине

`setOrderField(field: keyof IOrderData, value: string | Payment)` — позволяет установить значение определнного поля в объекте заказа

`setOrderItems(items: string[])` — позволяет указать весь массив с `id` товаров в поле `items` объекта заказа

`inCart(id: string): boolean` — позволяет проверить, находится ли в корзине товар с указанным `id`

`validate(data: Partial<IOrderData>): IFormState` — валидирует данные, указанные при оформлении заказа

#### Класс `ShopAPI`

Класс для работы с API магазина.

Конструктор принимает следующие аргументы:

`baseUrl: string` — основная ссылка на API

`cdn: string` — ссылка для изображений (является полем класса)

##### Методы класса

`getItems(): Promise<IProductList>` — позволяет получить список товаров с сервера

`getItem(id: string): Promise<IShopItem>` — позволяет получить определенный товар с сервера

`placeOrder(): Promise<IOrderResult>` — позволяет разместить заказ на сервере

### Компоненты представления

#### Класс `Page`

Наследует класс `Component` с переданным типом `<IPage>`.

Отвечает за отображение каталога товаров и индикатора количества товаров в корзине.

Использует родительский конструктор.

##### Поля класса

`_items: HTMLElement` — каталог товаров

`_cartAmount: HTMLElement` — индикатор количества товаров в корзине

##### Методы класса

`set items(value: HTMLElement[])` — наполняет элемент каталога `_items` карточками товаров

`set cartAmount(value: number)` — позволяет отобразить в элементе `_cartAmount` количество товаров в корзине

#### Класс `Button`

Наследует класс `Component` с переданным типом `<IButton>`.

Используется для кнопок, чье текстовое содержимое и статус активности могут меняться динамически.

Использует родительский конструктор.

##### Методы класса

`set buttonActive(value: boolean)` — меняет статус активности кнопки в зависимости от значения

`set buttonText(value: string)` — определяет текстовое содержимое кнопки

#### Класс `CatalogItem<T extends IShopItem = IShopItem>`

Наследует класс `Component<T>`. По умолчанию принимает в переменную `T` объект, соответствующий интерфейсу `IShopItem`, но позволяет использовать любой другой интерфейс, расширяющий `IShopItem`, у классов, которые его наследуют.

Используется для отображения карточки товара в каталоге.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_title: HTMLElement` — название товара

`_category: HTMLElement` — категория товара

`_image: HTMLImageElement` — изображение товара

`_price: HTMLElement` — цена товара

`_id: number` — идентификатор товара (передается в брокер событий при нажатии на карточку)

##### Методы класса

`set title(value: string)` — задает текстовое содержимое элемента `_title`

`set category(value: ItemCategory)` — определяет отображение элемента `_category`

`set image(value: string)` — отвечает за отображение элемента `_image`

`set price(value: Price)` — определяет отображение элемента `_price`

`set id(value: number)` — определяет значение поля `_id`

#### Класс `Modal`

Наследует класс `Component` с переданным типом `<IModal>`.

Используется для отображения модального окна с любым содержимым.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_closeButton: HTMLButtonElement` — кнопка закрытия модального окна

`_content: HTMLElement` — содержимое модального окна

##### Методы класса

`set content(value: HTMLElement)` — определяет содержимое элемента `_content`

`open()` — отвечает за открытие модального окна

`close()` — отвечает за закрытие модального окна

`isOpen(content?: HTMLElement): boolean` — позволяет проверить, открыто ли модальное окно, а также при желании проверить, открыто ли окно с определенным содержимым

#### Класс `ItemPreview`

Наследует класс `CatalogItem` с переданным типом `<IItemPreview>`.

Используется для просмотра подробной информации о товаре с возможностью добавить его в корзину.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

Имеет все поля родительского класса, а также перечисленные ниже.

`_description: HTMLElement` — описание товара

`_button: Button` — кнопка добавления товара в корзину или удаления из корзины

##### Методы класса

`set description(value: string)` — определяет текстовое содержимое элемента `_description`

`set inCart(value: boolean)` — меняет текст кнопки в зависимости от значения

`renderButton(data: partial<IButton>)` — позволяет задать текст и статус активности кнопки

#### Класс `Cart`

Наследует класс `Component` с переданным типом `<ICart>`.

Используется для отображения списка добавленных в корзину товаров с возможностью приступить к формлению заказа.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_items: HTMLElement` — контейнер для списка добавленных товаров

`_button: Button` — кнопка оформления заказа

`_total: HTMLElement` — суммарная стоимость заказа

##### Методы класса

`set items(value: HTMLElement[])` — наполняет элемент `_items` карточками товаров

`set total( value: Price)` — определяет текстовое содержимое элемента `_total`

`renderButton(data: partial<IButton>)` — позволяет установить статус активности кнопки

#### Класс `CartItem`

Наследует класс `Component` с переданным типом `<ICartItem>`.

Используется для отображения индивидуального товара в списке корзины с возможностью его удаления.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_index: HTMLElement` — порядковый номер товара в списке

`_title: HTMLElement` — название товара

`_price: HTMLElement` — цена товара

`_deleteButton: HTMLButtonElement` — кнопка удаления товара

`_id: string` — идентификатор товара (передается в брокер событий при нажатии на кнопку удаления)

##### Методы класса

`set title(value: string)` — определяет текстовое содержимое элемента `_title`

`set price(value: Price)` — определяет текстовое содержимое элемента `_price`

`set id(value: string)` — определяет значение поля `_id`

#### Класс `Toggler`

Наследует класс `Component` с переданным типом `<IToggler>`.

Используется для отображения переключателя с несколькими кнопками (например, переключение способа оплаты).

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_buttons: Button[]` — массив со всеми кнопками в переключателе

`_selected: string` — название выбранной кнопки, соответствующее ее атрибуту `name`

##### Методы класса

`set selected(name: string)` — делает кнопку с указанным атрибутом `name` неактивной и задает соответствующее значение для поля `_selected`

#### Класс `Form`

Наследует класс `Component` с переданным типом `<IFormState>`.

Используется для отображения всех форм в проекте.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_button: Button` — кнопка сабмита формы

`_error: HTMLElement` — отображение ошибок при заполнении или сабмите формы

`_inputs: HTMLInputElement[]` — массив с текстовыми полями формы

`_toggler?: Toggler` — опциональный переключатель

##### Методы класса

`set errors(value: keyof IOrderData[])` — отвечает за отображение текстовых полей, с которыми связаны ошибки

`set valid(data: boolean)` — изменяет статус активности кнопки в зависимости от значения

`displayError(value: string)` — определяет текстовое содержимое элемента `_error`

#### Класс `OrderSuccess`

Наследует класс `Component` с переданным типом `<ITotalPrice>`.

Отвечает за отображение подтверждения успешной покупки.

Конструктор принимает аргументы `container: HTMLElement` (основной контейнер компонента) и `events: IEvents` (брокер событий).

##### Поля класса

`_spent: HTMLElement` — общая сумма заказа

`_button: HTMLButtonElement` — кнопка подтверждения для перехода на главный экран

##### Методы класса

`set total(value: Price)` — определяет текстовое содержимое элемента `_spent`